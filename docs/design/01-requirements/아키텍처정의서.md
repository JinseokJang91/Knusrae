# Knusrae 아키텍처 정의서

## 문서 정보

| 항목 | 내용 |
|------|------|
| 프로젝트명 | Knusrae (크누래) |
| 문서명 | 아키텍처 정의서 |
| 버전 | 1.0 |
| 작성일 | 2026-02-20 |

---

## 1. 개요

본 문서는 Knusrae 애플리케이션의 **시스템 구성**, **서비스 아키텍처**, **주요 데이터·처리 흐름**을 도식으로 정리한다.  
Flow 차트 및 다이어그램은 Mermaid를 사용하며, 뷰어에서 렌더링하면 한 눈에 구조를 파악할 수 있다.

---

## 2. 시스템 컨텍스트

시스템 외부 액터와 Knusrae와의 관계를 나타낸다.

```mermaid
flowchart LR
    subgraph External["외부"]
        User["사용자"]
        OAuth["OAuth 제공자\n(네이버/구글/카카오)"]
    end

    subgraph Knusrae["Knusrae 시스템"]
        Web["웹 애플리케이션\n(Vue 3 SPA)"]
        API["백엔드 API\n(Spring Boot)"]
    end

    User <-->|"HTTPS\n브라우저"| Web
    User -.->|"로그인 리다이렉트"| OAuth
    OAuth -.->|"인증 코드/토큰"| API
    Web <-->|"REST API\n(JWT)"| API
```

---

## 3. 백엔드 서비스 구성

백엔드는 **마이크로서비스** 형태로 4개 서비스로 구성된다.

```mermaid
flowchart TB
    subgraph Client["클라이언트"]
        Browser["브라우저\n(Vue 3 + Vite)"]
    end

    subgraph Backend["백엔드 서비스"]
        subgraph Auth["auth-service"]
            A1["AuthController\nOAuth callback\nJWT 발급/갱신/로그아웃"]
        end
        subgraph Member["member-service"]
            M1["MemberController\n프로필 조회/수정"]
            M2["FollowController\n팔로우/언팔로우\n팔로워·팔로잉 목록"]
            M3["InquiryController\n1:1 문의 CRUD\n답변"]
        end
        subgraph Cook["cook-service"]
            C1["RecipeController\n레시피 CRUD\n인기/피드"]
            C2["RecipeCommentController\n댓글"]
            C3["RecipeBookController\nRecipeBookmarkController\n레시피북·북마크"]
            C4["RecipeFavoriteController\n찜"]
            C5["RecipeViewController\n조회 기록"]
            C6["RecommendationController\n오늘의 추천"]
            C7["CategoryController\n테마·카테고리"]
            C8["ThemeCollectionController\nAdminThemeCollection"]
            C9["CreatorController\n추천 크리에이터"]
            C10["SearchController\n레시피 검색"]
            C11["IngredientController\nIngredientRequest\nAdminIngredient"]
        end
        subgraph Common["common-service"]
            O1["CommonCodeController\nAdminCommonCodeController"]
            O2["공통 도메인\n(Follow, Member 엔티티 등)"]
        end
    end

    subgraph Data["데이터 저장소"]
        MySQL[(MySQL)]
        Redis[(Redis\n캐시)]
    end

    Browser -->|"REST"| Auth
    Browser -->|"REST"| Member
    Browser -->|"REST"| Cook
    Browser -->|"REST"| Common

    Auth --> MySQL
    Member --> MySQL
    Cook --> MySQL
    Cook --> Redis
    Common --> MySQL
```

---

## 4. 서비스별 역할 요약

| 서비스 | 역할 | 주요 API Prefix |
|--------|------|-----------------|
| **auth-service** | OAuth 로그인, JWT 발급/갱신/로그아웃 | /api/auth |
| **member-service** | 회원 프로필, 팔로우, 1:1 문의 | /api/member, /api/follows, /api/inquiries |
| **cook-service** | 레시피·댓글·북마크·찜·조회·추천·테마·카테고리·크리에이터·검색·재료·관리자 재료 | /api/recipe, /api/recipes, /api/themes, /api/creators, /api/categories, /api/search, /api/ingredients, /api/admin |
| **common-service** | 공통코드 조회/관리, 공통 엔티티(Follow 등) | /api/common-codes, /api/admin/common-codes |

---

## 5. 프론트엔드 구조

프론트엔드는 **단일 SPA**이며, 레이아웃·라우터·상태·API 계층으로 구분된다.

```mermaid
flowchart TB
    subgraph Frontend["프론트엔드 (Vue 3)"]
        subgraph Views["Views (페이지)"]
            V1["Dashboard\n메인"]
            V2["Recipe*\n레시피 목록/상세/작성/수정"]
            V3["My*\n마이페이지/내 레시피/문의/찜/북마크"]
            V4["Admin*\n관리자"]
            V5["Auth\n로그인/OAuth 콜백"]
            V6["Ranking\nFAQ\nMemberProfile\nFollowingFeed"]
        end

        subgraph Layout["Layout"]
            AppLayout["AppLayout\n(Header + Main + Footer)"]
        end

        subgraph State["상태"]
            AuthStore["authStore\n(로그인/토큰)"]
        end

        subgraph API["API 클라이언트"]
            authApi["authApi"]
            recipeApi["recipeApi"]
            memberApi["memberApi"]
            bookmarkApi["bookmarkApi"]
            themeApi["themeApi"]
            creatorApi["creatorApi"]
            Others["... (search, follow, inquiry 등)"]
        end

        AppLayout --> V1 & V2 & V3 & V4 & V6
        V5 -.->|"로그인 후"| AppLayout
        V1 & V2 & V3 & V4 & V6 --> AuthStore
        V1 & V2 & V3 & V4 & V6 --> API
        API -->|"Axios\nJWT 첨부"| Backend["백엔드 API"]
    end
```

---

## 6. 주요 처리 흐름

### 6.1 로그인 흐름 (OAuth + JWT)

```mermaid
sequenceDiagram
    participant U as 사용자
    participant V as Vue (Login)
    participant A as auth-service
    participant O as OAuth 제공자

    U->>V: 로그인 버튼 클릭
    V->>O: 로그인 페이지 리다이렉트
    U->>O: 인증
    O->>V: callback URL + code
    V->>A: GET/POST /api/auth/{provider}/callback?code=...
    A->>O: code → access_token 교환
    O-->>A: token
    A->>A: 회원 조회/생성, JWT 생성
    A-->>V: accessToken, refreshToken 등
    V->>V: authStore 저장, 홈 이동
    V-->>U: 대시보드 표시
```

### 6.2 레시피 상세 조회 및 조회 기록

```mermaid
sequenceDiagram
    participant U as 사용자
    participant V as RecipeDetail.vue
    participant C as cook-service
    participant M as MySQL

    U->>V: 레시피 상세 진입
    V->>C: GET /api/recipe/{id}
    C->>M: 레시피 조회
    M-->>C: 레시피
    C-->>V: 레시피 상세

    alt 로그인 사용자
        V->>C: POST /api/recipes/{id}/view
        C->>M: RecipeView 저장/갱신
        C-->>V: 200 OK
    end

    V-->>U: 상세 화면 표시
```

### 6.3 대시보드 데이터 로딩 (병렬)

```mermaid
flowchart LR
    subgraph User["사용자"]
        A["대시보드 접근"]
    end

    subgraph Load["병렬 로딩"]
        B1["오늘의 추천\n/recommendations/today"]
        B2["인기 레시피\n/recipes/popular"]
        B3["테마 목록\n/themes/active"]
        B4["트렌딩 카테고리\n/categories/trending"]
        B5["최근 본\n(로그인 시)\n/recent-views"]
        B6["추천 크리에이터\n/creators/recommended"]
    end

    subgraph UI["화면 섹션"]
        U1["TodayRecommendations"]
        U2["PopularRecipes"]
        U3["ThemeCollections"]
        U4["CategorySections"]
        U5["RecentViews"]
        U6["RecommendedCreators"]
    end

    A --> Load
    B1 --> U1
    B2 --> U2
    B3 --> U3
    B4 --> U4
    B5 --> U5
    B6 --> U6
```

### 6.4 레시피 북마크 저장 흐름

```mermaid
sequenceDiagram
    participant U as 사용자
    participant V as BookmarkDialog.vue
    participant B as cook-service (Bookmark/RecipeBook API)

    U->>V: 레시피에서 '북마크' 클릭
    V->>B: GET /api/recipe/bookmarks/recipe-books (내 레시피북 목록)
    B-->>V: recipeBooks[]
    V-->>U: 레시피북 선택 다이얼로그 표시

    U->>V: 레시피북 선택 후 저장
    V->>B: 북마크 추가 (해당 recipe-book에 레시피 추가)
    B-->>V: 성공
    V-->>U: 토스트 후 다이얼로그 닫기
```

---

## 7. 기술 스택 요약

| 구분 | 기술 |
|------|------|
| **프론트엔드** | Vue 3, TypeScript, Pinia, Vue Router, PrimeVue, Axios, Vite |
| **백엔드** | Java 17, Spring Boot 3.x, Spring Security, JPA, QueryDSL |
| **DB** | MySQL 8.0 |
| **캐시** | Redis (선택·일부 API 캐싱) |
| **인증** | JWT, OAuth2 (네이버/구글/카카오) |
| **기타** | Spring Scheduler (인기 점수 등 배치성 작업) |

---

## 8. 디렉토리 구조 (참고)

```
Knusrae/
├── frontend/                 # Vue 3 SPA
│   ├── src/
│   │   ├── api/              # API 클라이언트
│   │   ├── components/       # 공통·도메인별 컴포넌트
│   │   ├── layout/
│   │   ├── router/
│   │   ├── stores/
│   │   ├── types/
│   │   ├── views/            # 페이지 단위 View
│   │   └── main.ts
│   └── ...
├── backend/
│   ├── auth-service/
│   ├── member-service/
│   ├── cook-service/
│   └── common-service/
└── docs/
    └── design/
        ├── 01-requirements/  # 본 요구사항·아키텍처
        ├── 02-interface/
        ├── 03-table-definition/
        └── 05-program-list/
```

---

## 9. 변경 이력

| 버전 | 일자 | 변경 내용 |
|------|------|-----------|
| 1.0 | 2026-02-20 | 최초 작성(시스템·서비스·프론트 구조 및 주요 플로우) |
